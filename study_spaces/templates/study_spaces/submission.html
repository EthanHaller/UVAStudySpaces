<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Submit a Study Space</title>

		{% load static %} {% load bootstrap5 %} {# Load Bootstrap CSS #} {% bootstrap_css %} {% load bootstrap_icons %}
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	</head>

	<body>
		{% include 'study_spaces/navbar.html' %}
		<div class="container-fluid col-md-8 col-lg-6 mx-auto">
			<h3 class="mt-5 mb-3">Submit a New Study Space!</h3>
			<form method="post" class="form-multiline">
				{% csrf_token %} {% if error_message %}
				<p class="alert alert-danger"><strong>{{ error_message }}</strong></p>
				{% endif %}
				<div class="mb-3">
					<label for="id-name" class="form-label">Study Space Name:</label>
					<input required type="text" class="form-control" id="id-name" name="name" placeholder="Rice Hall" />
				</div>
				<div class="mb-3">
					<label for="id-google-address" class="form-label">Address:</label>
					<input required type="text" class="form-control" size="50" id="id-google-address" name="address" />
				</div>
				<input type="hidden" class="geo" id="id-lat" name="lat" value="" />
				<input type="hidden" class="geo" id="id-long" name="long" value="" />

				<h5 class="mt-5">Amenities</h5>

				<div class="form-check p-0">
					<div class="row align-items-center">
						<div class="col-auto">{% bs_icon 'wifi' size='1.75em' extra_classes='feature-icon' %}</div>
						<div class="col">
							<input type="checkbox" class="form-check-input" id="id-has-wifi" name="has_wifi" />
							<label class="form-check-label" for="id-has-wifi">Wifi</label>
						</div>
					</div>
				</div>
				<div class="form-check p-0">
					<div class="row align-items-center">
						<div class="col-auto">{% bs_icon 'outlet' size='1.75em' extra_classes='feature-icon' %}</div>
						<div class="col">
							<input type="checkbox" class="form-check-input" id="id-has-outlets" name="has_outlets" />
							<label class="form-check-label" for="id-has-outlets">Outlets</label>
						</div>
					</div>
				</div>
				<div class="form-check p-0">
					<div class="row align-items-center">
						<div class="col-auto">{% bs_icon 'printer' size='1.75em' extra_classes='feature-icon' %}</div>
						<div class="col">
							<input type="checkbox" class="form-check-input" id="id-has-printers" name="has_printers" />
							<label class="form-check-label" for="id-has-printers">Printers</label>
						</div>
					</div>
				</div>
				<div class="form-check p-0">
					<div class="row align-items-center">
						<div class="col-auto">{% bs_icon 'easel' size='1.75em' extra_classes='feature-icon' %}</div>
						<div class="col">
							<input type="checkbox" class="form-check-input" id="id-has-whiteboards" name="has_whiteboards" />
							<label class="form-check-label" for="id-has-whiteboards">Whiteboards</label>
						</div>
					</div>
				</div>
				<div class="form-check p-0">
					<div class="row align-items-center">
						<div class="col-auto">{% bs_icon 'bell-slash' size='1.75em' extra_classes='feature-icon' %}</div>
						<div class="col">
							<input type="checkbox" class="form-check-input" id="id-is-quiet" name="is_quiet" />
							<label class="form-check-label" for="id-is-quiet">Quiet</label>
						</div>
					</div>
				</div>
				<div class="form-check p-0">
					<div class="row align-items-center">
						<div class="col-auto">{% bs_icon 'sun' size='1.75em' extra_classes='feature-icon' %}</div>
						<div class="col">
							<input type="checkbox" class="form-check-input" id="id-is-outside" name="is_outside" />
							<label class="form-check-label" for="id-is-outside">Outside</label>
						</div>
					</div>
				</div>
				<div class="form-check p-0">
					<div class="row align-items-center">
						<div class="col-auto">{% bs_icon 'cup' size='1.75em' extra_classes='feature-icon' %}</div>
						<div class="col">
							<input type="checkbox" class="form-check-input" id="id-has-food" name="has_food" />
							<label class="form-check-label" for="id-has-food">Food Nearby</label>
						</div>
					</div>
				</div>
				<button type="submit" class="btn btn-primary float-end" formaction="{% url 'study_spaces:submission' %}">Submit</button>
			</form>
			{% if submitted_list_length != 0 %}
			<h3>Past Submissions</h3>
			{% endif %} {% for x in submitted_list %}
			<div class="mb-3">
				<p>Study Space Name: {{ x.name }}</p>
				<p>Address: {{ x.address }}</p>
				<p>
					Approval Status: {% if x.approved_submission == 1 %} Approved! {% elif x.approved_submission == 0 %} Pending... {% elif
					x.approved_submission == -1 %} Denied.<br />
					Denial Reason: {{ x.denial_reason }} {% endif %}
				</p>
			</div>
			{% endfor %}
		</div>

		<script>
			var google_api_key = "{{google_api_key|safe}}"
		</script>
		<script type="text/javascript">
			$.getScript("https://maps.googleapis.com/maps/api/js?key=" + google_api_key + "&libraries=places").done(function (script, textStatus) {
				google.maps.event.addDomListener(window, "load", initAutocomplete())
			})

			function initAutocomplete(callback) {
				let autocomplete = new google.maps.places.Autocomplete(document.getElementById("id-google-address"), {
					types: ["address"],
					componentRestrictions: {
						country: ["usa"],
					},
				})

				autocomplete.addListener("place_changed", () => {
					const place = autocomplete.getPlace()
					onPlaceChanged(place)
				})
			}

			function onPlaceChanged(place) {
				let el_id = "id-google-address"
				let lat_id = "id-lat"
				let long_id = "id-long"
				var geocoder = new google.maps.Geocoder()
				var address = document.getElementById(el_id).value

				geocoder.geocode(
					{
						address: address,
					},
					function (results, status) {
						if (status == google.maps.GeocoderStatus.OK) {
							var latitude = results[0].geometry.location.lat()
							var longitude = results[0].geometry.location.lng()
							$("#" + lat_id).val(latitude)
							$("#" + long_id).val(longitude)
						} else {
							$("#" + lat_id).val("")
							$("#" + long_id).val("")
						}
					}
				)
			}
		</script>
	</body>
</html>
